const TRANSLATIONS = {
  en: {
    'app.name': 'SpeedMaster',
    'app.subtitle': 'Universal Media Playback Controller',
    'common.enable': 'Enable',
    'common.disable': 'Disable',
    'common.restore': 'Restore',
    'controller.speedLabel': 'Speed:',
    'controller.button.decrease': 'Decrease speed',
    'controller.button.increase': 'Increase speed',
    'controller.button.reset': 'Reset',
    'controller.button.reset.aria': 'Reset playback speed to 1x',
    'controller.button.boost': 'Boost mode',
    'controller.button.boostActive': 'Restore normal',
    'controller.button.boost.aria': 'Toggle boost playback speed',
    'controller.button.minimize': 'Minimise panel',
    'controller.button.close': 'Close panel',
    'controller.button.minimise.aria': 'Minimise panel',
    'controller.button.close.aria': 'Close control panel',
    'controller.exclude.label': 'Hide on this site',
    'controller.exclude.checkbox': 'Do not show on this domain',
    'controller.exclude.tooltip': 'Hide permanently on this domain',
    'controller.drag.handle': 'Drag to move',
    'controller.minimised.label': 'Open',
    'popup.status.noMedia': 'No audio or video detected. Start playback to connect.',
    'popup.status.excluded': 'This site is disabled. Choose "Enable Site" to re-activate.',
    'popup.status.disabledOverlay': 'Page overlay is disabled in settings.',
    'popup.overlay.show': 'Show overlay',
    'popup.overlay.hide': 'Hide overlay',
    'popup.overlay.disabled': 'Overlay disabled',
    'popup.overlay.blocked': 'Overlay unavailable',
    'popup.overlay.open.title': 'Enable page overlay',
    'popup.overlay.close.title': 'Disable page overlay',
    'popup.overlay.disabled.title': 'Enable page overlay from options',
    'popup.overlay.blocked.title': 'Unblock site to use overlay',
    'popup.domain.block': 'Disable site',
    'popup.domain.unblock': 'Enable site',
    'popup.domain.nohost': 'Disable site',
    'popup.domain.block.title': 'Disable current site',
    'popup.domain.unblock.title': 'Enable current site',
    'popup.domain.nohost.title': 'No domain detected',
    'popup.domain.blocked.message': 'Site {domain} disabled. Select "Enable Site" to resume.',
    'popup.domain.unblocked.message': 'Site {domain} enabled. Reload to apply.',
    'popup.domain.block.message': 'Site {domain} disabled. Reload to apply.',
    'popup.theme.toggle.title.light': 'Currently light theme, switch to dark',
    'popup.theme.toggle.title.dark': 'Currently dark theme, switch to light',
    'popup.speed.label': 'Quick speeds',
    'popup.speed.current': 'Current speed',
    'popup.actions.overlay': 'Overlay',
    'popup.actions.domain': 'Site',
    'options.title': 'SpeedMaster Settings',
    'options.subtitle': 'Manage domains, behaviour, and appearance for the controller.',
    'options.section.settings': 'Global Settings',
    'options.section.excluded': 'Excluded Domains',
    'options.field.maxSpeed': 'Maximum speed (0.5 – 15)',
    'options.field.displayMode': 'Default location',
    'options.field.theme': 'Default theme',
    'options.field.language': 'Language',
    'options.field.display.page': 'Page overlay',
    'options.field.display.popup': 'Popup only',
    'options.field.display.both': 'Overlay + popup',
    'options.field.theme.dark': 'Dark',
    'options.field.theme.light': 'Light',
    'options.field.theme.auto': 'Follow system',
    'options.field.language.en': 'English',
    'options.field.language.zh-CN': '中文 (简体)',
    'options.hint.maxSpeed': 'Controls the highest selectable playback speed.',
    'options.hint.displayMode': 'Choose where the controller appears by default.',
    'options.hint.theme': 'Popup and overlay share the same theme.',
    'options.hint.language': 'Affects popup, overlay, and options.',
    'options.hint.domains': 'Domains are stored in lowercase and cover all subdomains.',
    'options.addDomain.label': 'Add domain:',
    'options.addDomain.placeholder': 'example.com',
    'options.addDomain.button': 'Add',
    'options.domain.empty': 'No excluded domains',
    'options.domain.remove': 'Remove',
    'options.footer.tip': 'Tip: You can also toggle sites directly from the popup.',
    'options.toast.added': 'Domain {domain} added.',
    'options.toast.removed': 'Domain {domain} removed.',
    'options.toast.invalid': 'Enter a valid domain name.',
    'options.toast.language': 'Language updated.',
    'message.error.noMedia': 'No controllable media found on this page.',
    'message.error.toggleOverlay': 'Unable to toggle overlay.',
    'message.error.updateDomain': 'Unable to update excluded domains.',
    'message.error.unknownCommand': 'Unknown command.',
    'message.error.generic': 'An unexpected error occurred.',
    'message.error.boostUnavailable': 'Boost mode unavailable. Check the maximum speed cap.',
    'message.success.overlayEnabled': 'Overlay enabled.',
    'message.success.overlayDisabled': 'Overlay disabled.'
  },
  'zh-CN': {
    'app.name': 'SpeedMaster',
    'app.subtitle': '全能音视频倍速控制器',
    'common.enable': '启用',
    'common.disable': '禁用',
    'common.restore': '恢复',
    'controller.speedLabel': '速度：',
    'controller.button.decrease': '减慢播放速度',
    'controller.button.increase': '加快播放速度',
    'controller.button.reset': '重置',
    'controller.button.reset.aria': '恢复播放速度至 1 倍',
    'controller.button.boost': '超级加速',
    'controller.button.boostActive': '恢复常速',
    'controller.button.boost.aria': '切换超级加速模式',
    'controller.button.minimize': '最小化',
    'controller.button.close': '关闭',
    'controller.button.minimise.aria': '最小化控制面板',
    'controller.button.close.aria': '关闭控制面板',
    'controller.exclude.label': '本域名不再显示',
    'controller.exclude.checkbox': '此域名下不再显示控制面板',
    'controller.exclude.tooltip': '关闭后将永久隐藏此域名的面板',
    'controller.drag.handle': '拖动以移动',
    'controller.minimised.label': '展开',
    'popup.status.noMedia': '尚未检测到音视频，请开始播放后再试。',
    'popup.status.excluded': '该站点已禁用，可选择“该站点启用”重新恢复。',
    'popup.status.disabledOverlay': '已在设置中关闭网页浮窗。',
    'popup.overlay.show': '显示浮窗',
    'popup.overlay.hide': '隐藏浮窗',
    'popup.overlay.disabled': '浮窗不可用',
    'popup.overlay.blocked': '浮窗不可用',
    'popup.overlay.open.title': '打开网页浮窗',
    'popup.overlay.close.title': '关闭网页浮窗',
    'popup.overlay.disabled.title': '请在设置中启用网页浮窗',
    'popup.overlay.blocked.title': '解除站点屏蔽后可使用浮窗',
    'popup.domain.block': '该站点禁用',
    'popup.domain.unblock': '该站点启用',
    'popup.domain.nohost': '该站点禁用',
    'popup.domain.block.title': '禁用当前站点',
    'popup.domain.unblock.title': '恢复当前站点',
    'popup.domain.nohost.title': '未检测到域名',
    'popup.domain.blocked.message': '{domain} 已禁用，可选择“该站点启用”恢复。',
    'popup.domain.unblocked.message': '{domain} 已恢复，刷新页面生效。',
    'popup.domain.block.message': '{domain} 已禁用，刷新页面生效。',
    'popup.theme.toggle.title.light': '当前为明亮主题，点击切换暗色',
    'popup.theme.toggle.title.dark': '当前为暗色主题，点击切换明亮',
    'popup.speed.label': '快捷倍速',
    'popup.speed.current': '当前倍速',
    'popup.actions.overlay': '网页浮窗',
    'popup.actions.domain': '站点开关',
    'options.title': 'SpeedMaster 设置',
    'options.subtitle': '配置控制器的语言、主题及站点策略。',
    'options.section.settings': '全局设置',
    'options.section.excluded': '排除站点',
    'options.field.maxSpeed': '最高倍速 (0.5 – 15)',
    'options.field.displayMode': '默认展示位置',
    'options.field.theme': '默认主题',
    'options.field.language': '界面语言',
    'options.field.display.page': '网页浮窗',
    'options.field.display.popup': '仅弹出页',
    'options.field.display.both': '浮窗 + 弹出页',
    'options.field.theme.dark': '暗色',
    'options.field.theme.light': '明亮',
    'options.field.theme.auto': '跟随系统',
    'options.field.language.en': 'English',
    'options.field.language.zh-CN': '中文 (简体)',
    'options.hint.maxSpeed': '用于限制可选的最高播放倍速。',
    'options.hint.displayMode': '选择控制器默认显示的位置。',
    'options.hint.theme': '弹出页与网页浮窗共享同一主题。',
    'options.hint.language': '影响弹出页、浮窗与设置页面。',
    'options.hint.domains': '域名将以小写保存，并覆盖所有子域名。',
    'options.addDomain.label': '添加域名：',
    'options.addDomain.placeholder': 'example.com',
    'options.addDomain.button': '添加',
    'options.domain.empty': '暂无排除站点',
    'options.domain.remove': '删除',
    'options.footer.tip': '提示：也可以直接在弹出页切换站点状态。',
    'options.toast.added': '已加入 {domain}。',
    'options.toast.removed': '已移除 {domain}。',
    'options.toast.invalid': '请输入有效域名。',
    'options.toast.language': '界面语言已更新。',
    'message.error.noMedia': '当前页面没有可控制的媒体元素。',
    'message.error.toggleOverlay': '切换网页浮窗失败。',
    'message.error.updateDomain': '更新排除站点失败。',
    'message.error.unknownCommand': '未知指令。',
    'message.error.generic': '发生未知错误。',
    'message.error.boostUnavailable': '无法切换超级加速，请检查最高倍速设置。',
    'message.success.overlayEnabled': '网页浮窗已开启。',
    'message.success.overlayDisabled': '网页浮窗已关闭。'
  }
};

export const SUPPORTED_LANGUAGES = ['en', 'zh-CN'];

export function translate(language = 'en', key, replacements = {}) {
  const table = TRANSLATIONS[language] || TRANSLATIONS.en;
  const template = table[key] || TRANSLATIONS.en[key] || key;
  return Object.keys(replacements).reduce(
    (acc, placeholder) => acc.replace(new RegExp(`{${placeholder}}`, 'g'), replacements[placeholder]),
    template
  );
}

export function getTranslations(language = 'en') {
  return TRANSLATIONS[language] || TRANSLATIONS.en;
}

export function applyTranslations(root, language = 'en') {
  if (!root) return;
  const table = getTranslations(language);
  root.querySelectorAll('[data-i18n]').forEach((node) => {
    const key = node.getAttribute('data-i18n');
    if (!key) return;
    const text = table[key] || TRANSLATIONS.en[key];
    if (text) node.textContent = text;
  });
}
